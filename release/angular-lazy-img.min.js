angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers",function(e,n,t,o){"use strict";function i(){for(var e=d.length-1;e>=0;e--){var n=d[e];n&&o.isElementInView(n.$elem[0],y.offset,m)&&!n.viewed?(c(n),d[e].viewed=!0):n&&o.isElementHidden(n.$elem[0],y.offset,m)&&(l(n.$elem,null),d[e].viewed=!1)}0===d.length&&u()}function r(e){v.forEach(function(n){n[e]("scroll",I),n[e]("touchmove",I)}),f[e]("resize",I),f[e]("resize",p)}function s(){h=!0,setTimeout(function(){i(),r("on")},1)}function u(){h=!1,r("off")}function a(e){var n=d.indexOf(e);-1!==n&&d.splice(n,1)}function c(e){var t=new Image;t.onerror=function(){y.errorClass&&e.$elem.addClass(y.errorClass),n.$emit("lazyImg:error",e),y.onError(e)},t.onload=function(){l(e.$elem,e.src),y.successClass&&e.$elem.addClass(y.successClass),n.$emit("lazyImg:success",e),y.onSuccess(e)},t.src=e.src}function l(e,n){"img"===e[0].nodeName.toLowerCase()?e[0].src=n:e.css("background-image",'url("'+n+'")'),null==n&&("img"===e[0].nodeName.toLowerCase()?e[0].removeAttribute("src"):e[0].removeAttribute("style"))}function g(e){this.$elem=e}var m,f,d,h,y,I,p,v;return d=[],h=!1,y=t.getOptions(),f=angular.element(e),m=o.getWinDimensions(),p=o.throttle(function(){m=o.getWinDimensions()},60),v=[y.container||f],I=o.throttle(i,30),g.prototype.setSource=function(e){this.src=e,d.unshift(this),h||s()},g.prototype.removeImage=function(){a(this),0===d.length&&u()},g.prototype.checkImages=function(){i()},g.addContainer=function(e){u(),v.push(e),s()},g.removeContainer=function(e){u(),v.splice(v.indexOf(e),1),s()},g}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function n(){return{height:e.innerHeight,width:e.innerWidth}}function t(e,n,t){var o=e.getBoundingClientRect(),i=t.height+n;return o.left>=0&&o.right<=t.width+n&&(o.top>=0&&o.top<=i||o.bottom<=i&&o.bottom>=0-n)}function o(e,n,t){var o=e.getBoundingClientRect();return!(o.right>=0&&o.left<=t.width+o.width)}function i(e,n,t){var o,i;return function(){var r=t||this,s=+new Date,u=arguments;o&&o+n>s?(clearTimeout(i),i=setTimeout(function(){o=s,e.apply(r,u)},n)):(o=s,e.apply(r,u))}}return{isElementInView:t,isElementHidden:o,getWinDimensions:n,throttle:i}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(e,n){"use strict";function t(t,o,i){var r=new n(o),s=i.$observe("lazyImg",function(e){e&&(s(),r.setSource(e))});t.$on("$destroy",function(){r.removeImage()}),e.$on("lazyImg.runCheck",function(){r.checkImages()}),e.$on("lazyImg:refresh",function(){r.checkImages()})}return{link:t,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(e){"use strict";function n(n,t){e.addContainer(t),n.$on("$destroy",function(){e.removeContainer(t)})}return{link:n,restrict:"A"}}]);